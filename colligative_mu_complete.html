<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>束一的性質（完成版）｜μ–T交点が動く</title>

<style>
body{
  margin:0;
  background:#0b0c10;
  color:#e9eef5;
  font-family:system-ui,-apple-system,"Segoe UI","Noto Sans JP",sans-serif;
}
.wrap{max-width:1100px;margin:auto;padding:16px;}
h1{font-size:22px;margin-bottom:10px}
.row{display:grid;grid-template-columns:1fr 340px;gap:16px}
.card{background:#11131a;border:1px solid #2a2f3a;border-radius:12px;padding:14px}
canvas{width:100%;border-radius:10px;background:#0f1118;border:1px solid #2a2f3a}

.tabbar{display:flex;gap:10px;margin-bottom:10px}
.tab{
  padding:8px 14px;border-radius:10px;
  border:1px solid #3a4150;
  cursor:pointer;color:#aab4c0
}
.tab.active{background:#1a2030;color:#fff}

label{font-size:14px;color:#aab4c0}
input[type=range]{width:100%}
.val{font-size:15px;margin-bottom:10px}

.kpi{
  background:#0f1118;border:1px solid #2a2f3a;
  border-radius:10px;padding:10px;margin-top:10px
}
.kpi-title{font-size:13px;color:#aab4c0}
.kpi-val{font-size:18px;margin-top:4px}

</style>
</head>

<body>
<div class="wrap">
<h1>束一的性質（最小モデル完成版）：μ–T の交点が動く ⇒ ΔT<sub>f</sub>, ΔT<sub>b</sub></h1>

<div class="row">
<div class="card">
  <div class="tabbar">
    <div class="tab active" id="tabF">凝固点降下（液–固）</div>
    <div class="tab" id="tabB">沸点上昇（液–気）</div>
  </div>
  <canvas id="cv" width="900" height="520"></canvas>
</div>

<div class="card">
  <label>溶質モル分率 x₂（x₁ = 1 − x₂）</label>
  <input id="x2" type="range" min="0" max="0.30" step="0.001" value="0.05">
  <div class="val">x₂=<span id="x2v"></span> / x₁=<span id="x1v"></span></div>

  <label>表示温度範囲（自動調整されます）</label>
  <input id="tmin" type="range" min="120" max="400" step="1" value="150">
  <div class="val">T_min=<span id="tminv"></span> K</div>
  <input id="tmax" type="range" min="300" max="800" step="1" value="350">
  <div class="val">T_max=<span id="tmaxv"></span> K</div>

  <div class="kpi">
    <div class="kpi-title">純溶媒の平衡温度</div>
    <div class="kpi-val" id="T0">—</div>
  </div>
  <div class="kpi">
    <div class="kpi-title">溶液の平衡温度</div>
    <div class="kpi-val" id="Tx">—</div>
  </div>
  <div class="kpi">
    <div class="kpi-title">温度差 ΔT</div>
    <div class="kpi-val" id="dT">—</div>
  </div>
</div>
</div>
</div>

<script>
const R=0.008314;
const searchLo=120, searchHi=800;

const params={
 freeze:{
  As:12, ms:-0.045,
  Al:18, ml:-0.075,
  labelA:"μ_solid(T)",
  labelB:"μ_liquid(T)"
 },
 boil:{
  Ag:30, mg:-0.095,
  Al:18, ml:-0.075,
  labelA:"μ_gas(T)",
  labelB:"μ_liquid(T)"
 }
};

let mode="freeze";
const cv=document.getElementById("cv"),ctx=cv.getContext("2d");
const x2=document.getElementById("x2"),tmin=document.getElementById("tmin"),tmax=document.getElementById("tmax");
const x2v=document.getElementById("x2v"),x1v=document.getElementById("x1v");
const tminv=document.getElementById("tminv"),tmaxv=document.getElementById("tmaxv");
const T0el=document.getElementById("T0"),Txel=document.getElementById("Tx"),dTel=document.getElementById("dT");

document.getElementById("tabF").onclick=()=>setMode("freeze");
document.getElementById("tabB").onclick=()=>setMode("boil");
[x2,tmin,tmax].forEach(e=>e.oninput=render);

function setMode(m){
 mode=m;
 document.getElementById("tabF").classList.toggle("active",m==="freeze");
 document.getElementById("tabB").classList.toggle("active",m==="boil");
 if(m==="freeze"){tmin.value=150;tmax.value=330;}
 else{tmin.value=300;tmax.value=720;}
 render();
}

const mu=(A,m,T)=>A+m*T;
const muMix=(Al,ml,T,x1)=>mu(Al,ml,T)+R*T*Math.log(Math.max(1e-9,x1));

function solve(f){
 let a=searchLo,b=searchHi;
 let fa=f(a),fb=f(b);
 if(fa*fb>0)return NaN;
 for(let i=0;i<80;i++){
  let c=(a+b)/2,fc=f(c);
  if(Math.abs(fc)<1e-6)return c;
  if(fa*fc<=0){b=c;fb=fc}else{a=c;fa=fc}
 }
 return (a+b)/2;
}

function render(){
 const x2v0=parseFloat(x2.value),x1=1-x2v0;
 const Tmin=parseFloat(tmin.value),Tmax=parseFloat(tmax.value);
 x2v.textContent=x2v0.toFixed(3);
 x1v.textContent=x1.toFixed(3);
 tminv.textContent=Tmin;tmaxv.textContent=Tmax;

 const p=params[mode];
 let T0,Tx;

 if(mode==="freeze"){
  T0=(p.Al-p.As)/(p.ms-p.ml);
  Tx=solve(T=>mu(p.As,p.ms,T)-muMix(p.Al,p.ml,T,x1));
 }else{
  T0=(p.Al-p.Ag)/(p.mg-p.ml);
  Tx=solve(T=>mu(p.Ag,p.mg,T)-muMix(p.Al,p.ml,T,x1));
 }

 T0el.textContent=isFinite(T0)?T0.toFixed(2)+" K":"—";
 Txel.textContent=isFinite(Tx)?Tx.toFixed(2)+" K":"—";
 dTel.textContent=isFinite(Tx)?(Tx-T0).toFixed(3)+" K":"—";

 draw(Tmin,Tmax,p,x1,T0,Tx);
}

function draw(Tmin,Tmax,p,x1,T0,Tx){
 ctx.clearRect(0,0,cv.width,cv.height);
 const m={l:80,r:20,t:30,b:70};
 const W=cv.width-m.l-m.r,H=cv.height-m.t-m.b;
 const xp=T=>m.l+(T-Tmin)/(Tmax-Tmin)*W;

 let muMin=1e9, muMax=-1e9;

 // μ軸スケールは「純溶媒」で固定
 for(let i=0;i<=300;i++){
  let T = Tmin + (Tmax-Tmin)*i/300;
  let a,b;
  if(mode==="freeze"){
    a = mu(p.As,p.ms,T);
    b = mu(p.Al,p.ml,T);
  } else {
    a = mu(p.Ag,p.mg,T);
    b = mu(p.Al,p.ml,T);
  }
  muMin = Math.min(muMin, a, b);
  muMax = Math.max(muMax, a, b);
 }

 const yp=mu=>m.t+(muMax-mu)/(muMax-muMin)*H;

 // グリッド
 ctx.strokeStyle = "rgba(255,255,255,0.12)";
 ctx.lineWidth = 1;
 for(let i=0;i<=10;i++){
  let y = m.t + H*i/10;
  ctx.beginPath();
  ctx.moveTo(m.l, y);
  ctx.lineTo(m.l+W, y);
  ctx.stroke();
 }

 // 軸
 ctx.strokeStyle="#9aa3b2";
 ctx.lineWidth=2.5;
 ctx.beginPath();
 ctx.moveTo(m.l,m.t);
 ctx.lineTo(m.l,m.t+H);
 ctx.lineTo(m.l+W,m.t+H);
 ctx.stroke();

 // 線描画
 const drawLine=(f,col,dash)=>{
  ctx.strokeStyle=col;
  ctx.lineWidth=3;
  ctx.setLineDash(dash||[]);
  ctx.beginPath();
  for(let i=0;i<=300;i++){
   let T=Tmin+(Tmax-Tmin)*i/300;
   let x=xp(T), y=yp(f(T));
   if(i===0) ctx.moveTo(x,y);
   else ctx.lineTo(x,y);
  }
  ctx.stroke();
  ctx.setLineDash([]);
 };

 if(mode==="freeze"){
  drawLine(T=>mu(p.As,p.ms,T),"#7aa2ff");
  drawLine(T=>mu(p.Al,p.ml,T),"#9be37a",[6,4]);
  drawLine(T=>muMix(p.Al,p.ml,T,x1),"#f7d06b");
 }else{
  drawLine(T=>mu(p.Ag,p.mg,T),"#7aa2ff");
  drawLine(T=>mu(p.Al,p.ml,T),"#9be37a",[6,4]);
  drawLine(T=>muMix(p.Al,p.ml,T,x1),"#f7d06b");
 }

 // 軸ラベル
 ctx.fillStyle="#e9eef5";
 ctx.font="bold 20px system-ui";
 ctx.fillText("μ",30,m.t+H/2);
 ctx.fillText("T (K)",m.l+W/2-20,m.t+H+55);
}



render();
</script>
</body>
</html>
